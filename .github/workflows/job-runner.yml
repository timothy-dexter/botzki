name: Run thepopebot Job

on:
  create:

jobs:
  run-agent:
    runs-on: ubuntu-latest
    if: github.ref_type == 'branch' && startsWith(github.ref_name, 'job/')
    permissions:
      contents: write

    steps:
      - name: Run thepopebot Agent
        run: |
          docker run --rm \
            -e REPO_URL="${{ github.server_url }}/${{ github.repository }}.git" \
            -e BRANCH="${{ github.ref_name }}" \
            -e GH_TOKEN="${{ secrets.GH_TOKEN }}" \
            -e PI_AUTH="${{ secrets.PI_AUTH }}" \
            -e SECRETS="${{ secrets.SECRETS }}" \
            stephengpope/thepopebot:latest
